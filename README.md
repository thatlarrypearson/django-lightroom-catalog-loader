# Django Lightroom Classic Catalog Image File Loader & Web Interface

This [Django](https://www.djangoproject.com/) application contains a number of management commands for acquiring and manipulating image file information.  Web access is also part of the application.

The [Custom Management Commands](https://docs.djangoproject.com/en/3.0/howto/custom-management-commands/):

- Extract image file data from Adobe Lightroom Classic catalogs and load that data into a database.
- Match images from Lightroom catalogs to collected file system data for use in later analysis.
- Find missing image files on backups and create scripts to copy the files from backups to appropriate directories in Lightroom directories.

## ```get_lightroom_catalog```

The Django management program, ```get_lightroom_catalog```, extracts image file data from Lightroom Classic databases and writes that data into a database.  Additionally, the catalog data can be browsed in the Django administrative interface or accessed through REST APIs.

### USAGE

```powershell
PS C:\Users\human\Documents\src\django-project-example\src> python3.8 manage.py get_lightroom_catalog --help
usage: manage.py get_lightroom_catalog [-h] [--version] [-v {0,1,2,3}] [--settings SETTINGS] [--pythonpath PYTHONPATH]
                                       [--traceback] [--no-color] [--force-color] [--skip-checks]
                                       base_path [base_path ...]

Searches a file system and loads file information into the database

positional arguments:
  base_path             Relative or absolute file path to Adobe Lightroom SQLite Database, example:
                        Pictures/Lightroom/Lightroom Catalog.lrcat

optional arguments:
  -h, --help            show this help message and exit
  --version             show program's version number and exit
  -v {0,1,2,3}, --verbosity {0,1,2,3}
                        Verbosity level; 0=minimal output, 1=normal output, 2=verbose output, 3=very verbose output
  --settings SETTINGS   The Python path to a settings module, e.g. "myproject.settings.main". If this isn't provided,
                        the DJANGO_SETTINGS_MODULE environment variable will be used.
  --pythonpath PYTHONPATH
                        A directory to add to the Python path, e.g. "/home/djangoprojects/myproject".
  --traceback           Raise on CommandError exceptions
  --no-color            Don't colorize the command output.
  --force-color         Force colorization of the command output.
  --skip-checks         Skip system checks.
PS C:\Users\human\Documents\src\django-project-example\src>
```
#### Example Linux/Mac ```bash``` Shell Commands To Find All Image File Names Contained in Multiple Lightroom Classic Catalogs

Lightroom Classic catalog files are typically found in ```Pictures/Lightroom``` (```Pictures\Lightroom``` on Windows) off the home directory.  The catalog files are easily recognized as they have ```lrcat``` for the file extension.

On Linux/Mac, the catalog files might look like the following.

```bash
human@hostname ~/Pictures/Lightroom
$ ls -l
total 2211128
drwxr-xr-x 1 human 197609         0 Jul 17 14:23  Backups/
-rw-r--r-- 1 human 197609  25022464 Dec 22  2019 'Lightroom 5 Catalog.lrcat'
drwxr-xr-x 1 human 197609         0 Nov  1  2019 'Lightroom Catalog Helper.lrdata'/
-rw-r--r-- 1 human 197609 726310912 Nov  1  2019 'Lightroom Catalog.lrcat'
drwxr-xr-x 1 human 197609         0 Jul 17 14:25 'Lightroom Catalog-2 Helper.lrdata'/
drwxr-xr-x 1 human 197609         0 Jul 17 14:25 'Lightroom Catalog-2 Previews.lrdata'/
-rw-r--r-- 1 human 197609 759431168 Jul 17 14:25 'Lightroom Catalog-2.lrcat'
drwxr-xr-x 1 human 197609         0 Dec 22  2019 'Lightroom Catalog-3 Helper.lrdata'/
drwxr-xr-x 1 human 197609         0 Dec 22  2019 'Lightroom Catalog-3 Previews.lrdata'/
-rw-r--r-- 1 human 197609 736919552 Dec 22  2019 'Lightroom Catalog-3.lrcat'
drwxr-xr-x 1 human 197609         0 Dec 22  2019 'Lightroom Catalog-4 Helper.lrdata'/
drwxr-xr-x 1 human 197609         0 Dec 22  2019 'Lightroom Catalog-4 Previews.lrdata'/
-rw-r--r-- 1 human 197609  16502784 Dec 22  2019 'Lightroom Catalog-4.lrcat'
drwxr-xr-x 1 human 197609         0 Dec  9  2018 'Lightroom Settings'/

human@hostname ~/Pictures/Lightroom
$
```

Notice the ```Backups``` directory. ```lrcat``` backup files generated by Lightroom are under this directory and maybe stored in zip archive files with ```lrcat.zip``` as the extension. 

To see a list of all ```lrcat``` files including the backups, run the following ```find``` commands.

```bash
human@hostname ~/Pictures/Lightroom
$ find . -name '*.lrcat' -print ; find . -name '*.lrcat.zip' -print
./Lightroom 5 Catalog.lrcat
./Lightroom Catalog-2.lrcat
./Lightroom Catalog-3.lrcat
./Lightroom Catalog-4.lrcat
./Lightroom Catalog.lrcat
./Backups/2020-06-24 1526/Lightroom Catalog-2.lrcat.zip
./Backups/2020-07-17 1423/Lightroom Catalog-2.lrcat.zip

human@hostname ~/Pictures/Lightroom
$
```
Zipped ```lrcat``` database files will need to be unzipped in order to extract the image file names and data.  Unzipping can be done with the ```unzip``` command.

From the Django server's base directory, the following command will load image file data into the Django database.  This may take some time to run depending on the number and size of the image catalog files.

```bash
python3.8 manage.py get_lightroom_catalog $(find ~/Pictures/Lightroom -name '*.lrcat' -print)
```

#### Example Windows PowerShell Commands To Find All Image File Names Contained in Multiple Lightroom Classic Catalogs

On Windows 10 using PowerShell, each ```lrcat``` file will need to be listed separately.

```powershell
python3.8 manage.py get_lightroom_catalog "C:\Users\human\Pictures\Lightroom\Lightroom 5 Catalog.lrcat"
```

## ```match_images_to_file_system```

Django Management program matches images found by ```get_lightroom_catalog``` to images (if possible) in the file lists collected by ```get_file_system``` in ```django-filesystem-searcher```, another Django application.  Potential and positive image matches between Lightroom catalogs and file system data are stored in the database for later analysis.

### USAGE

```powershell
PS C:\Users\human\Documents\src\django-project-example\src> python3.8 manage.py match_images_to_file_system --help
usage: manage.py match_images_to_file_system [-h] [--lr_hostname LR_HOSTNAME] [--fs_hostname FS_HOSTNAME]
                                             [--fs_volume FS_VOLUME] [--lrcat_hostname LRCAT_HOSTNAME]
                                             [--lrcat_volume LRCAT_VOLUME] [--version] [-v {0,1,2,3}]
                                             [--settings SETTINGS] [--pythonpath PYTHONPATH] [--traceback]
                                             [--no-color] [--force-color] [--skip-checks]

Matches images found by ```get_lightroom_catalog``` to images (if possible) in the file lists collected by
get_file_system in django-filesystem-searcher, another Django application. Potential and positive image matches
between Lightroom catalogs and file system data are stored in the database for later analysis.

optional arguments:
  -h, --help            show this help message and exit
  --lr_hostname LR_HOSTNAME
                        Limit matches to Lightroom hostname.
  --fs_hostname FS_HOSTNAME
                        Limit matches to file system hostname.
  --fs_volume FS_VOLUME
                        Limit matches to file system volume.
  --lrcat_hostname LRCAT_HOSTNAME
                        Hostname where working Lightroom catalog is located.
  --lrcat_volume LRCAT_VOLUME
                        Volume where working Lightroom catalog is located.
  --version             show program's version number and exit
  -v {0,1,2,3}, --verbosity {0,1,2,3}
                        Verbosity level; 0=minimal output, 1=normal output, 2=verbose output, 3=very verbose output
  --settings SETTINGS   The Python path to a settings module, e.g. "myproject.settings.main". If this isn't provided,
                        the DJANGO_SETTINGS_MODULE environment variable will be used.
  --pythonpath PYTHONPATH
                        A directory to add to the Python path, e.g. "/home/djangoprojects/myproject".
  --traceback           Raise on CommandError exceptions
  --no-color            Don't colorize the command output.
  --force-color         Force colorization of the command output.
  --skip-checks         Skip system checks.
PS C:\Users\human\Documents\src\django-project-example\src>
```

## Installation

### Dependencies

The following Python dependencies are used to run this Django application.

- Python version greater than or equal to 3.6
- ```pip``` version >= 20.1.1
- ```setuptools``` version >= 38.3.0
- ```wheel``` version >= 0.34.2
- ```Django``` >= 3.0.8
- ```djangorestframework``` version 3.11.0
- ```uritemplate``` >= 3.0.1
- ```pyyaml``` >= 5.3.1
- ```markdown``` version >= 3.2.2
- ```django-filter``` version >= 2.3.0

The following dependencies are available on [```github.com```](https://github.com).
- ```file_system_searcher``` >= 3, [File-System-Searcher](https://github.com/thatlarrypearson/File-System-Searcher.git)
- ```lr_reader``` version >= 3, [Lightroom-Reader](https://github.com/thatlarrypearson/Lightroom-Reader.git)
- ```django_fs_searcher``` version >= 3, [Django-File-System-Searcher](https://gitub.com/thatlarrypearson/Django-File-System-Searcher.git)


### Install

Validate your python installation.

```powershell
PS C:\Users\human> python --version
Python 3.7.6
PS C:\Users\human> python3.8 --version
Python 3.8.3
PS C:\Users\human>
```

Install and/or upgrade the required Python packages.

```bash
python3.8 -m pip install pip --upgrade
python3.8 -m pip install setuptools --upgrade
python3.8 -m pip install wheel --upgrade
python3.8 -m pip install Django djangorestframework uritemplate pyyaml markdown django-filter
```

To install, clone the code from ```github```, build the package and install with pip:

```bash
git clone https://gitub.com/thatlarrypearson/Django-Lightroom-Classic-Catalog-Image-File-Loader.git
cd Django-Lightroom-Classic-Catalog-Loader
python3.8 setup.py sdist
python3.8 -m pip install .
```

## Django Server Integration

The Django application needs to be run by a Django server.  An example Django server can be pulled from the [```django-project-example``` repository](https://github.com/thatlarrypearson/django-project-example).

Unfamiliar with Django?  Visit the [Django Project](https://www.djangoproject.com/) for information on getting started with Django.

### ```settings.py```

Add ```django_lr_loader``` and ```restframework``` to ```INSTALLED_APPS``` in the ```settings.py``` file.

```python
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'rest_framework',
    'django_lr_loader',
]
```

Check database settings.  Visit [Django Settings](https://docs.djangoproject.com/en/3.0/ref/settings/#databases
) for database settings information.

### ```urls.py```

Add a path for ```django_lr_loader``` to ```urlpatterns``` as shown below.

```python
urlpatterns = [
    path('admin/', admin.site.urls),
    path('accounts/', include('django.contrib.auth.urls')),
  
    path('lightroom_loader/', include('django_lr_loader.urls')),
]
 ```

### Complete Setup Using ```manage.py``` Commands

From the server's base directory, run the following Django management command to prepare the database for use with the new application.

```bash
python3.8 manage.py makemigrations django_lr_loader
python3.8 manage.py migrate django_lr_loader
```



